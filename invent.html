<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie showcase</title>
    <style>
        .cart-section {
            background-color: #fff;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #cart-list {
            list-style: none;
            padding: 0;
        }

        #cart-list li {
            margin-bottom: 10px;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #0abdcd;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
            background-color: #10bcd3;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .movie-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .movie {
            width: calc(33.33% - 20px);
            margin-bottom: 20px;
            background-color: #16b7c5;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .movie img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        .movie-info {
            padding: 10px;
            text-align: center;
        }

        .movie-title {
            font-size: 1.2rem;
            margin: 0;
        }

        .movie-year {
            color: #777;
        }

        @media screen and (max-width: 768px) {
            .movie {
                width: calc(50% - 20px);
            }
        }

        .movie {
            width: calc(33.33% - 20px);
            margin-bottom: 20px;
            background-color: #16b7c5;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .movie img {
            max-width: 100%;
            height: auto;
            display: block;
        }
    </style>
    <!-- Add this script tag to the head of your HTML file -->
    <script defer src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js"></script>

    <script defer>
        // Paste your Firebase configuration here


        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Get a reference to the database
        const db = firebase.database();
    </script>


</head>

<body>
    <div class="container" id="output">
        <h1>Movie Showcase</h1>
        <div class="movie-list"></div>
        <ul id="cart-list"></ul>
        <p>Total Price: $<span id="total-price">0.00</span></p>
        <div class="products" id="output"></div>
    </div>

    <script type="module" async>

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD6vtDos7dBccm4jRZR7nFv4RMgucnxWfg",
            authDomain: "kelly2-d0e0c.firebaseapp.com",
            projectId: "kelly2-d0e0c",
            storageBucket: "kelly2-d0e0c.appspot.com",
            messagingSenderId: "586673821546",
            appId: "1:586673821546:web:ed19cfdfff2c879117f713",
            measurementId: "G-DHL16T4TG0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function fetchData() {
            try {
                const querySnapshot = await getDocs(collection(db, "movies"));
                const allProducts = document.getElementById('output');

                querySnapshot.forEach(async (doc) => {
                    const data = doc.data();
                    allProducts.innerHTML += `
                        <a href="${data.id}.html" class="movie">
                            <img src="${data.image}" alt="${data.movie}">
                            <div class="movie-info">
                                <h2 class="movie-title">${data.movie}</h2>
                                <p class="movie-year">${data.length}</p>
                                <p class="movie-year">${data.year}</p>
                                <p class="movie-year">${data.price}</p>
                                <div class="reviews-section" id="reviews-${data.id}"></div>
                            </div>
                        </a>
                        <form id="review-form-${data.id}">
                            <label for="user-${data.id}">Your Name:</label>
        <input type="text" id="user-${data.id}" name="user" required>
        <label for="rating-${data.id}">Rating (1-5):</label>
        <input type="number" id="rating-${data.id}" name="rating" min="1" max="5" required>
        <label for="comment-${data.id}">Your Review:</label>
        <textarea id="comment-${data.id}" name="comment" required></textarea>
        <!-- Add any additional form elements here -->
        <button type="button" onclick="submitReview('${data.id}')">Submit Review</button>
                        </form>`;

                    // Fetch and display reviews for each movie
                    const reviewsSection = document.getElementById(`reviews-${data.id}`);
                    const reviewsSnapshot = await getDocs(collection(db, "reviews", data.id));
                    reviewsSnapshot.forEach((reviewDoc) => {
                        const reviewData = reviewDoc.data();
                        reviewsSection.innerHTML += `
                            <div class="review">
                                <p><strong>${reviewData.user}</strong></p>
                                <p>Rating: ${reviewData.rating}</p>
                                <p>${reviewData.comment}</p>
                            </div>`;
                    });
                });
            } catch (error) {
                console.error("Error getting documents: ", error);
            }
        }

        async function submitReview(movieId) {
            const user = document.getElementById(`user-${movieId}`).value;
            const rating = document.getElementById(`rating-${movieId}`).value;
            const comment = document.getElementById(`comment-${movieId}`).value;

            try {
                // Add the review to the "reviews" collection in Firebase
                await addDoc(collection(db, "reviews", movieId), {
                    user,
                    rating,
                    comment,
                });

                // Refresh the reviews section after submitting the review
                const reviewsSection = document.getElementById(`reviews-${movieId}`);
                reviewsSection.innerHTML = ""; // Clear previous reviews
                const reviewsSnapshot = await getDocs(collection(db, "reviews", movieId));
                reviewsSnapshot.forEach((reviewDoc) => {
                    const reviewData = reviewDoc.data();
                    reviewsSection.innerHTML += `
                        <div class="review">
                            <p><strong>${reviewData.user}</strong></p>
                            <p>Rating: ${reviewData.rating}</p>
                            <p>${reviewData.comment}</p>
                        </div>`;
                });
            } catch (error) {
                console.error("Error submitting review: ", error);
            }
        }

        fetchData();
        // Add these functions along with your existing code

const cartList = document.getElementById('cart-list');
let totalPrice = 0;

function addToCart(movieId, movieTitle, moviePrice) {
    const cartItem = document.createElement('li');
    cartItem.innerHTML = `${movieTitle} - $${moviePrice.toFixed(2)}`;
    cartList.appendChild(cartItem);

    // Update total price
    totalPrice += moviePrice;
    updateTotalPrice();
}

function updateTotalPrice() {
    const totalPriceElement = document.getElementById('total-price');
    totalPriceElement.textContent = totalPrice.toFixed(2);
}

// Modify your existing fetchData function to include a button for adding to the cart
async function fetchData() {
    try {
        const querySnapshot = await getDocs(collection(db, "movies"));
        const allProducts = document.getElementById('output');

        querySnapshot.forEach(async (doc) => {
            const data = doc.data();
            allProducts.innerHTML += `
                <!-- ... existing code ... -->
                <button onclick="addToCart('${data.id}', '${data.movie}', ${data.price})">Add to Cart</button>
                <!-- ... existing code ... -->`;

            // ... existing code ...
        });
    } catch (error) {
        console.error("Error getting documents: ", error);
    }
}

// Update your submitReview function to also update the total price
async function submitReview(movieId) {
    // ... existing code ...

    // Update total price after submitting the review
    const movieData = await doc(collection(db, "movies", movieId)).get();
    const moviePrice = movieData.data().price;
    totalPrice += moviePrice;
    updateTotalPrice();
}


    </script>
</body>

</html>